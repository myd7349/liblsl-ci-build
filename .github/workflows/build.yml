name: liblsl

on:
  push:
  pull_request:
    types: [ opened, ready_for_review, reopened, synchronize ]

env:
  BUILD_TYPE: Release
  INSTALL_PREFIX: install

jobs:
  build-windows:
    name: build-${{ matrix.setup_vcpkg }}-${{ matrix.revert_commit }}
    runs-on: windows-latest
    strategy:
      fail-fast: false
      matrix:
        include:
          - setup_vcpkg: false
            revert_commit: false

          - setup_vcpkg: true
            revert_commit: false

          - setup_vcpkg: true
            revert_commit: true

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Clone liblsl
        run: git clone https://github.com/sccn/liblsl.git

      - name: Setup vcpkg
        if: matrix.setup_vcpkg == true
        run: |
          vcpkg integrate install
          vcpkg install boost-intrusive

      - name: Revert 07ba6a7
        if: matrix.revert_commit == true
        run: |
          pushd liblsl
          git revert 07ba6a7 --no-edit
          popd

      - name: Configure
        run: >
          cmake
          -S liblsl
          -B build
          -G "Visual Studio 17 2022"
          -A x64
          -DLSL_BUILD_STATIC=OFF
          -DCMAKE_INSTALL_PREFIX=${{ env.INSTALL_PREFIX }}

      - name: Build & Install
        run: |
          cmake --build build --config ${{ env.BUILD_TYPE }} --target install
